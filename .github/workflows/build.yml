name: "Build images"

on : [workflow_call] 

jobs:
    docker-frontend:
      name: Publish Frontend Docker image
      runs-on: ubuntu-latest
      env:
        REPO: ${{secrets.DOCKER_FRONTEND_REPO}}
      steps:
        - uses: actions/checkout@v3
        - name: Login to Docker Hub
          run : docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASS }}
        - name: Build Docker image
          working-directory: ./frontend
          run: docker build -t $REPO:latest -t $REPO:${GITHUB_SHA::8} .
        - name: Publish Docker Image
          run: docker push $REPO
    docker-api:
      name: Publish API Docker image
      runs-on: ubuntu-latest
      env:
        REPO: ${{secrets.DOCKER_API_REPO}}
      steps:
        - uses: actions/checkout@v3
        - name: Login to Docker Hub
          run : docker login -u ${{ secrets.DOCKER_USER }} -p ${{ secrets.DOCKER_PASS }}
        - name: Build Docker image
          working-directory: ./api
          run: docker build -t $REPO:latest -t $REPO:${GITHUB_SHA::8} .
        - name: Publish Docker Image
          run: docker push $REPO
